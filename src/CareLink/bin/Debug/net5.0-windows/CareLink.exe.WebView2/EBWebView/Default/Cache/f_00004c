<html>
<head>
  <title>Cumulus Remote Monitor</title>
  <meta http-equiv="cache-control" content="max-age=0"/>
  <meta http-equiv="cache-control" content="no-cache"/>
  <meta http-equiv="expires" content="0"/>
  <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
  <meta http-equiv="pragma" content="no-cache"/>

  <meta http-equiv="Content-type" content="text/html; charset=utf-8">

  <meta name="viewport"
        content="width=device-width, initial-scale=1.0,minimum-scale=1, maximum-scale=1, user-scalable=no"/>
  <!-- height=device-height, causing issues on iOS7 -->

  <!--<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>-->

  <link rel="stylesheet" type="text/css" href="../shared/jquery.mobile-1.2.0.min.css"/>
  <link rel="stylesheet" type="text/css" href="connect.css"/>

  <!--[if IE]>
  <style type="text/css">
    .debug-panel {
      top: 4.9em;
      bottom: 3.1em;
    }
  </style>
  <![endif]-->

  <script type="text/javascript" src="../shared/jquery-1.8.0.min.js"></script>
  <script type="text/javascript" src="../shared/jquery.mobile-1.2.0.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/bluebird@3.5.5/js/browser/bluebird.min.js"></script>

  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" type="image/png" href="../images/connect-icon.png"/>

  <!--set iOS specific info -->
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <link rel="apple-touch-icon-precomposed" href="../images/connect-icon.png"/>

  <script type="text/javascript">
      var qsParms = new Array();
      var cpSerialNumber = "NONE";
      var locationPath = "http";

      getQueryStrings();

      if (qsParms['cpSerialNumber'] != null) {
          cpSerialNumber = qsParms['cpSerialNumber'];
      }
      if (document.location.href.indexOf("https") === 0) {
          locationPath = "https";
      }

      function getQueryStrings() {
          var query = window.location.search.substring(1);
          var parms = query.split('&');
          for (var i = 0; i < parms.length; i++) {
              var pos = parms[i].indexOf('=');
              if (pos > 0) {
                  var key = parms[i].substring(0, pos);
                  var val = parms[i].substring(pos + 1);
                  qsParms[key] = val;
              }
          }
      }

      function connectDataUpdated(isAvailable) {
          window.parent.postMessage('updateData:' + isAvailable, '*');

          setConnectHasData(isAvailable);
      }

      function setConnectHasData(hasData) {
          if (!hasData) {
              document.body.classList.add('no-data');
          } else {
              document.body.classList.remove('no-data');
          }
      }
  </script>

  <script src="../shared/flotr2.min.js"></script>
  <script src="connect-class.js"></script>
  <script src="connect.app.js"></script>

</head>
<body class="no-data">
<div data-role="page" id="page-home" class="cpm-page page-home">
  <div data-role="content" class="hide-scroll" style="height: calc(100% - 100px); overflow-y: auto;">
    <section class="status">
      <div class="container-left-icon">
        <a id="statuspagelinkicon" href="#page-status" data-transition="none"
           class="c-sprite icon-contextual left-icon"></a>
      </div>
      <div id="username" class="username truncate"><span text='Initializing'></span></div>
      <div id="statuspagelink" class="container-updatedtime">
        <a id="statusupdateddatetime" href="#page-status" data-transition="none" class="status-message"><span
          text='Initializing'></span></a>
        <a href="#page-status" data-transition="none" id="statusupdateddatetime-icon"
           class="container-statuspagelink c-sprite status-message-icon"></a>
      </div>
      <div style="clear:both"></div>
      <div id="pumpBannerState" style="display:none;"></div>
    </section>
    <div style="clear:both"></div>

    <section id="mainbgsection" class="trend clearfix">
      <div id="autoModeActive">
        <span style="display:none;"></span>
      </div>
      <div class="c-sprite icon-nav value-details-icon"></div>
      <a class="c-sprite icon-nav bg-right-icon" style="display: none;"></a>
      <div id="bgtrendmain" class="trend-and-value">
        <div class="sensor-value">---</div>
        <div id="unitsLabelUpdated">
          <div class="c-sprite trend-icon"></div>
          <div class="value-details2">
            <div id="bgvaluets" class="units-label">--/--</div>
          </div>
        </div>
      </div>
      <div class="device-status" style="display: none;">
        <div class="sensor-state truncate"></div>
      </div>
      <div class="value-details">
        <div id="bgvaluetime" class="time-value"><span text='Initializing'></span></div>
        <div id="bgvaluedate" class="date-value"></div>
        <span id="bgvaluepumptimelabel" class="pump-time-label"></span>
      </div>
      <div id="currentInsulinPumpInfo">
        <div id="currentInsulinRateType">
          <span class="insulinRateType"><span class="insulinRate"><span text='Initializing'></span></span><br/><span
            class="insulinType">---</span></span>
          <div class="clearboth"></div>
        </div>
        <div id="pumpinfo-mobile">
          <span id="pumpinsulin-mobile" class="alarm-bolus-mobile insulin-mobile"><span class="label"><span
            text='Initializing'></span></span><span class="value">-- ?</span></span>
          <div class="clearboth"></div>
        </div>
      </div>
      <div id="pumpBannerStateMobile" style="display:none;"></div>
    </section>

    <section id="home-chart-wrapper">
      <!-- Chart Area -->
      <div id="bg-diagram">
      </div>

      <ul id="chartnav" class="clearfix nav-time-range">
        <li><a id="nav3hr" href="#3hr" class="link-3hr ui-selected">?</a></li>
        <li><a id="nav6hr" href="#6hr" class="link-6hr">?</a></li>
        <li><a id="nav12hr" href="#12hr" class="link-12hr">?</a></li>
        <li><a id="nav24hr" href="#24hr" class="link-24hr">?</a></li>
      </ul>

      <div id="home-chart-overlay"></div>
      <!-- /Chart Area -->
    </section>

    <footer id="alarmsfooter" data-role="footer" data-position="fixed" class="cpm-footer">
      <section id="alarmssection" class="alarms clearfix">
                    <span id="lastalarm" class="last-alarm-link" data-ignore="true">
                        <span text='Initializing'></span> --:-- -- --- -, ----
                        <b>--- -- -- --/--</b>
                    </span>
        <!-- ADDON -->
        <div id="pumpinfo" class="extended-ngp">
          <span id="pumpsuspend" class="alarm-suspended" data-ignore="true"></span>
          <span id="pumpbolus" class="alarm-bolus bolus"><span class="label"><span
            text='Initializing'></span></span><span class="value">-- ? (--)/--</span></span>
          <span id="pumpinsulin" class="alarm-bolus insulin"><span class="label"><span
            text='Initializing'></span></span><span class="value">-- ?</span></span>
          <div class="clearboth"></div>
        </div>
        <!-- ADDON -->
      </section>
    </footer>
  </div> <!-- /content -->
</div>
<!-- /Home page -->

<!-- Change implemented by Zimetrics -->
<!-- FG20-FSG10-FR10-TR10-SS1 - Time In Range Page -->
<div data-role="page" id="page-timeinrange" class="cpm-page page-timeinrange">
  <div data-role="content" class="hide-scroll" style="height: calc(100% - 90px); overflow-y: auto;">
    <section class="status">
      <div class="container-left-icon">
        <a id="statuspagelinkicon" href="#page-status" data-transition="none"
           class="c-sprite icon-contextual left-icon"></a>
      </div>
      <div id="username" class="username truncate"><span text='Initializing'></span></div>
      <div id="statuspagelink" class="container-updatedtime">
        <a id="statusupdateddatetime" href="#page-status" data-transition="none" class="status-message"><span
          text='Initializing'></span></a>
        <a href="#page-status" data-transition="none" id="statusupdateddatetime-icon"
           class="container-statuspagelink c-sprite status-message-icon"></a>
      </div>
    </section>
    <div style="clear:both"></div>
    <section id="timeInRange" class="timeInRangeTrend clearfix" style="display:block;">
      <a href="#page-home" data-rel="back" class="c-sprite icon-nav back-link-button"></a>
      <div style="text-align:center;position: relative;margin-bottom: 10px;">
        <span><span text='Ntime.in.range.timerrange'></span></span>
        <br/>
        <span text='Ntime.in.range.last.24hours'></span>
      </div>
      <div style="text-align:center;position: relative; height:130px; width:auto;">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.6/Chart.bundle.js"></script>
        <canvas id="myChart"></canvas>
      </div>
      <div style="text-align:center;margin-top:10px;">
        <span id="aboveHigh" style="color:#FFFFFF;">--%</span> <br/> <span id="aboveHighTxt" style="color:#FFCD00"><span
        text='Ntime.in.range.abovehigh.mgdl'></span></span>
      </div>
      <div style="text-align:center;margin-top:10px;">
        <span id="inRange" style="color:#FFFFFF;">--%</span> <br/> <span style="color:#00D7A5"><span
        text='Ntime.in.range.in.range'></span></span>
      </div>
      <div style="text-align:center;margin-top:10px;">
        <span id="belowLow" style="color:#FFFFFF;">--%</span> <br/> <span id="belowLowTxt" style="color:#FF415F"><span
        text='Ntime.in.range.belowlow.mgdl'></span></span>
      </div>
      <div style="text-align:center;margin-top:10px;">
        <span id="avgSg" style="color:#FFFFFF;">--- <span class="mgdl"></span></span> <br/> <span style="color:#FFFFFF"><span
        text='Ntime.in.range.average'></span></span>
      </div>
    </section>

    <section id="disabledTimeInRange" style="display:none;">
      <a href="#page-home" data-rel="back" class="c-sprite icon-nav back-link-button"></a>
      <div style="text-align:center;position: relative;margin-bottom: 10px;top:10px">
        <span><span text='Ntime.in.range.timerrange'></span></span><br/> <span
        text='Ntime.in.range.last.24hours'></span>
      </div>
      <div style="text-align:center;position: relative;margin-bottom: -28px;top:0px">
        <svg height="100" width="100">
          <circle cx="50" cy="50" r="40" stroke="white" stroke-width="3" fill="transparent" stroke-opacity="0.3"/>
          Sorry, your browser does not support inline SVG.
        </svg>
      </div>
      <div id="notEnoughData"><span text='Ntime.in.range.not.enough.data'></span></div>
      <div
        style="-webkit-filter: blur(1px); -moz-filter: blur(1px); -o-filter: blur(1px); -ms-filter: blur(1px); filter: blur(1px);padding-top:5px;">
        <div style="text-align:center;position: relative; height:0px; width:auto">
          <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.6/Chart.bundle.js"></script>
          <canvas id="disabledChart"></canvas>
        </div>
        <div style="text-align:center;margin-top:30px;">
          <span style="color:#FFFFFF;">--%</span> <br/> <span style="color:#FFA500"><span
          text='Ntime.in.range.abovehigh.mgdl'></span></span>
        </div>
        <div style="text-align:center;margin-top:20px;">
          <span style="color:#FFFFFF;">--%</span> <br/> <span style="color:#00FF00"><span
          text='Ntime.in.range.in.range'></span></span>
        </div>
        <div style="text-align:center;margin-top:20px;">
          <span style="color:#FFFFFF;">--%</span> <br/> <span style="color:#FF0000"><span
          text='Ntime.in.range.belowlow.mgdl'></span></span>
        </div>
        <div style="text-align:center;margin-top:20px;">
          <span style="color:#FFFFFF;">--- <span class="mgdl"></span> </span> <br/> <span style="color:#FFFFFF"><span
          text='Ntime.in.range.average'></span></span>
        </div>
      </div>
    </section>

    <footer id="alarmHeight" data-role="footer" data-position="fixed" class="cpm-footer" data-tap-toggle="false">
      <section class="alarms">
                    <span class="last-alarm-link" data-ignore="true">
                        <span text='Initializing'></span> --:-- -- --- -, ----
                        <b>--- -- -- --/--</b>
                    </span>
        <!-- Extended NGP Display -->
        <div class="extended-ngp">
          <span class="alarm-suspended" data-ignore="true"></span>
          <span class="alarm-bolus bolus"><span class="label"><span text='Initializing'></span></span><span
            class="value">-- <span class="insulin-units"></span> (--)/--</span></span>
          <span class="alarm-bolus insulin"><span class="label"><span text='Initializing'></span></span><span
            class="value">-- <span class="insulin-units"></span></span></span>
          <div class="clearboth"></div>
        </div>
        <!-- End: Extended NGP Display -->
      </section>
    </footer>
  </div> <!-- /content -->
</div>
<!-- Time In Range Page -->

<!-- Value Page -->
<div data-role="page" id="page-value" class="cpm-page page-value">
  <div data-role="content">
    <section class="status">
      <div class="container-left-icon">
        <a id="statuspagelinkicon" href="#page-status" data-transition="none"
           class="c-sprite icon-contextual left-icon"></a>
      </div>
      <div id="username" class="username truncate"><span text='Initializing'></span></div>
      <div id="statuspagelink" class="container-updatedtime">
        <a id="statusupdateddatetime" href="#page-status" data-transition="none" class="status-message"><span
          text='Initializing'></span></a>
        <a href="#page-status" data-transition="none" id="statusupdateddatetime-icon"
           class="container-statuspagelink c-sprite status-message-icon"></a>
      </div>
      <div style="clear:both"></div>
    </section>
    <div style="clear:both"></div>

    <section class="trend clearfix">
      <a href="#page-home" data-rel="back" class="c-sprite icon-nav back-link-button"></a>
      <div class="trend-and-value">
        <div class="c-sprite trend-icon"></div>
        <span class="sensor-value">---</span>
      </div>
      <div class="device-status" style="display: none;">
        <span class="sensor-state"></span>
      </div>
      <div class="value-details">
        <div class="units-label">--/--</div>
        <div class="time-value"><span text='Initializing'></span></div>
        <div class="date-value"></div>
        <span class="pump-time-label"><span text='Initializing'></span></span>
      </div>
    </section>

    <footer data-role="footer" data-position="fixed" class="cpm-footer" data-tap-toggle="false">
      <section class="alarms">
                    <span class="last-alarm-link" data-ignore="true">
                        <span text='Initializing'></span> --:-- -- --- -, ----
                        <b>--- -- -- --/--</b>
                    </span>
        <!-- Extended NGP Display -->
        <div class="extended-ngp">
          <span class="alarm-suspended" data-ignore="true"></span>
          <span class="alarm-bolus bolus"><span class="label"><span text='Initializing'></span></span><span
            class="value">-- <span class="insulin-units"></span> (--)/--</span></span>
          <span class="alarm-bolus insulin"><span class="label"><span text='Initializing'></span></span><span
            class="value">-- <span class="insulin-units"></span></span></span>
          <div class="clearboth"></div>
        </div>
        <!-- End: Extended NGP Display -->
      </section>
    </footer>
  </div> <!-- /content -->
</div>
<!-- /Value page -->

<!-- Begin Status Page -->
<div data-role="page" id="page-status" class="cpm-page page-status">
  <div data-role="content" class="hide-scroll" style="height: calc(100% - 48px); overflow-y: auto;">

    <div class="debug-panel">{}</div>
    <section class="status">
      <div class="container-left-icon">
        <a href="page-home" data-rel="back" class="c-sprite icon-contextual close-link-button"></a>
      </div>
      <div id="username" class="username truncate"><span text='Initializing'></span></div>
      <div id="statuspagelink" class="container-updatedtime">
        <a id="statusupdateddatetime" href="#page-status" data-transition="none" class="status-message"><span
          text='Initializing'></span></a>
        <a href="#page-status" data-transition="none" id="statusupdateddatetime-icon"
           class="container-statuspagelink c-sprite status-message-icon"></a>
      </div>
      <div style="clear:both"></div>
    </section>
    <div style="clear:both;"></div>
    <!-- Change implemented by Zimetrics -->
    <!-- FG20-FSG10-FR10-TR10-SS1 - Device status screen -->
    <section>
      <table class="device-status-table" style="color: #fff;">
        <tr class="cloudpost">
          <th class="device-status-table-heading"><span text='Initializing'></span></th>
          <!--<td class="status-icon-cell"><i class="icon"></i></td>
          <td class="status-icon-cell">
             <i class="icon conduitbattery cloudpost-battery"></i>
             <div><b>...</b>%</div>
          </td>-->
          <td class="status-icon-cell"><i class="icon cloudpost-in-range-signal-level"></i></td>
        </tr>
        <tr class="cloudpost-guardian">
          <th class="device-status-table-heading"><span text='Initializing'></span></th>
          <td class="status-icon-cell"><i class="icon cloudpost-GM-in-range-signal-level"></i></td>
          <td class="status-icon-cell"></td>
          <td class="status-icon-cell"></td>
        </tr>
        <tr>
          <td class="status-icon-cell"></td>
        </tr>
        <tr class="pump">
          <th class="device-status-table-heading"><span text='Initializing'></span></th>
          <td class="status-icon-cell">
            <i class="icon pump-in-range"></i>
            <div id="pumpInRange"><b>...</b></div>
          </td>
          <td class="status-icon-cell">
            <i class="icon battery pump-battery"></i>
            <div id="pumpBatteryLevel"><b>...</b>%</div>
          </td>
          <td class="status-icon-cell">
            <i class="icon pump-insuline-units"></i>
            <div id="pumpReservoirLevel"><b>...</b>?</div>
          </td>
        </tr>
        <tr>
          <td class="status-icon-cell"></td>
        </tr>
        <!-- end conditional rows -->
        <tr class="sensor">
          <th class="device-status-table-heading"><span text='Initializing'></span></th>
          <td class="status-icon-cell">
            <i class="icon sensor-in-range"></i>
            <div id="sensorInRange">&nbsp;</div>
          </td>
          <td class="status-icon-cell">
            <i class="icon sensor-calibration-due-time"></i>
            <div id="calibrationDue"><b>...</b>?</div>
          </td>
          <td class="status-icon-cell">
            <i class="icon sensor-days-to-change"></i>
            <div id="sensorDuration"><b>...</b>?</div>
          </td>
        </tr>
        <tr class="sensor-guardian">
          <th class="device-status-table-heading"><span text='Initializing'></span></th>
          <td class="status-icon-cell">
            <i class="icon sensor-calibration-due-time"></i>
            <div><b>...</b>?</div>
          </td>
          <td class="status-icon-cell">
            <i class="icon sensor-days-to-change"></i>
            <div><b>...</b>?</div>
          </td>
          <td class="status-icon-cell">
            <i class="icon sensor-in-range"></i>
            <div>&nbsp;</div>
          </td>
        </tr>
        <tr class="transmitter-guardian">
          <th class="device-status-table-heading"></th>
          <td class="status-icon-cell">
            <i class="icon sensorbattery"></i>
            <div><b>--</b> %</div>
          </td>
          <td class="status-icon-cell"></td>
          <td class="status-icon-cell"></td>
        </tr>
      </table>
    </section>
  </div> <!-- /content -->

  <footer data-role="footer" data-position="fixed" class="cpm-footer" data-tap-toggle="false">
    <div id="appidlabel" class="ifu-link"></div>
    <div id="appserialnumber" class="log-off-link"><i id="deviceSerialNumber">...</i></div>
    <a href="#" class="link-debug" data-role="none" style="display: none;">.</a>
  </footer>
</div> <!-- /Status Page -->

<!-- Begin Error Page -->
<div data-role="page" id="page-error" class="cpm-page page-error">
  <div data-role="content">
    <section class="header" data-role="header">
      <h1><span text='Initializing'></span></h1>
    </section>
    <section class="error-section">
      <h1><span text='Initializing'></span></h1>
      <p class="static-info"><span text='Initializing'></span></p>

      <section class="error-details" data-role="collapsible" data-mini="true">
        <h2 class="error-title"><span text='Initializing'></span></h2>
        <p class="error-text"></p>
      </section>
    </section>

    <footer data-role="footer" data-position="fixed" class="cpm-footer"></footer>
  </div>
</div>
<!-- End Error Page -->
<!-- </div> -->
<!-- End orientation-control -->

<script>
    (function ($) {
        $.cpm = {};


        $(document).bind('pagecreate create', function (e) {
        });

        /* Commented out - disabling the splash page temporarily.
        $('#page-splash').on('pageshow', function(e) {
            setTimeout(function(){
                $.mobile.changePage("#page-home", "fade");
            }, 1000);
        }); */

        $('#page-home').on('pageshow', function (e) {
            var cpm = new CPM();
            cpm.initAppScreen();
        });

        $('#page-status').on('pageshow', function (e) {
            var userRole = window.frameElement.getAttribute('data-role');
            var links = $('.dynamic-link');

            for (var i = 0; i < links.length; i++) {
                var link = links[i];
                if ($(link).attr('id') !== userRole) {
                    $(link).css('display', 'none')
                } else {
                    $(link).css('display', 'block')
                }
            }

            var cpm = new CPM();
            cpm.initAppScreen();
        });

        $('#page-value').on('pageshow', function (e) {
            var cpm = new CPM();
            cpm.initAppScreen();
        });
        /* Change implemented by Zimetrics */
        /* FG20-FSG10-FR10-TR10-SS1 - Time In Range Page */
        $('#page-timeinrange').on('pageshow', function (e) {
            var cpm = new CPM();
            cpm.initAppScreen();
        });

        $('#page-error').on('pageshow', function (e) {
            var cpm = new CPM();
            // For error page, we need no full app initialization, only localization
            var language = window.frameElement.getAttribute('data-language');
            var url = '../i18n/' + language + '.json';

            cpm.get(url).then(function(translations) {
                cpm.localizeResources(translations)
            });
        });

    })(jQuery);
</script>

</body>
</html>
